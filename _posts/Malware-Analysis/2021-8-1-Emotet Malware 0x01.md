---
title: Emotet Malware 0x01
classes: wide
header:
  teaser: /img/Emotet.jpg
ribbon: MidnightBlue
categories:
  - Malware-Analysis
toc: true
---

# Introduction
The Emotet banking Trojan was first identified by security researchers in 2014. Emotet was originally designed as a banking malware that attempted to sneak onto your computer and steal sensitive and private information. Later versions of the software saw the addition of spamming and malware delivery servicesâ€”including other banking Trojans.

# Examine Emotet with DIE
## Basic information
I will open malware with Detect It Easy tool to see some information about Emotet malware like compiler,type of packer if malware author use commercial packer to pack malware with it and type of linker and more information, so we can see the results in the next figure.

<p align="center">
<img src="https://user-images.githubusercontent.com/74544712/127772190-8b6f3a3d-963a-4f58-a486-ce2ac796b4f7.PNG">
</p>

# Entropy 
From the previous figure, we can identify some information about Emotet malware like as compiler and linker and the time that malware has been compiled on it and malware author can fake the time and the number of the sections that find in malware. Now I will examine the entropy to see if malware is packed or not and entropy is a good indicator that use by malware analysts to detect packed and some other techniques and we can see the results in the next figure.

<p align="center">
<img src="https://user-images.githubusercontent.com/74544712/127772891-12dd2423-1e7f-4874-8758-b8c8c60d5de2.PNG">
</p>

From the previous figure we can see the four sections and packed section which called rdata and see the 7.15835 number which give us good indicator that Emotet malware is packed.
# Examine Emotet with PeStudio 
## Sections 
Now we will examine the section with pestudio tool to get overview about section and some information about every section, so we can see four section in malware and we have one packed section which called .text that has high entropy number and we can see also that .text section is executable and we can see the results in the next figure.

![Figure03](https://user-images.githubusercontent.com/74544712/127919772-43e781b9-437a-4c6d-a638-e9853542c269.png)

## Strings 
If we examine the strings of malware, we can identify  a lot of malicious strings that can have us to get information about the behavior of malware and what it tries to do on a system and we can see the black list in the next figure.

![figure04](https://user-images.githubusercontent.com/74544712/127920380-04a483ae-dc9e-4b53-b1d7-00fbecc0436c.PNG)

# Examine Emotet with ida pro
## Identify Packed Emotet 
After examining malware with static analysis tool, we can open with a great tool which called ida pro to help us to understand assembly code and functionalities of malware that try to execute them and great tool also to identify packed malware with some techniques and we can see the following techniques that we can help us to identify if malware is packed or not.
* There are some of functions which used by the malware 
* There are common color in above bar
and we can see the results in the next figure

![figure05](https://user-images.githubusercontent.com/74544712/127921657-bb2811b8-10f0-4f3a-9d49-f33bc093bc48.PNG)

from the previous figure, we can see two indicators tell us that Emotet malware is packed, after examining the malware with ida pro we can get also some common techniques that used by malware analysts to identify packed malware.

If malware is packed we can search in code about jump with register or jump with a region of memory, because malware authors use a common techniques which called custom packer which goes throw with malware in some of loops and some of routines of encryption to decrypt payload in runtime to avoid antivirus and any security solution tools and if we go to start function from experts and click on start function and examine code, so we can identify interesting function that we will deep into it to see how malware author use it to unpack malware in runtime and we can see the name of function in the next figure from started function.

<p align="center">
<img src="https://user-images.githubusercontent.com/74544712/127922414-4418ecca-4f38-4c78-81c7-a52c823bc8c0.PNG">
</p>

# Structure of function 
After going into the function, we must know the prologue and epilogue. So every function in assembly code has three parts the first part is prologue and  three part is epilogue and we know that the first part and three part are simply as are set of instruction that set up the context for the function when it is called or cleaned, the prologue performs such operations as :
* save any register that function use them. 
* allocates storage on the stack k that function is need for save the local variables. 
* set up for any pointer like as parameters that pass to function. 
the epilogue needs to save any saved register and restore the stack pointer. 

# syntax of function
we will show the syntax in the function and this syntax is depend on the architecture that we work on it so the syntax can be different form architecture to another and we can see the next syntax for x86 assembly.

```
1:    push ebp
2:    mov ebp, esp    ---> prologue
3:    ...
4:    
5:    main code to do operation 
6:    
7:    ...
8:    mov esp, ebp
9:    pop ebp          ---> epilogue
10:   retn

```
But when we see the epilogue the function we can see that different about normal epilogue and malware authors use this to handle the process of reverse engineering  and we can see the results in the next figure 

<p align="center">
<img src="https://user-images.githubusercontent.com/74544712/127976471-0b3a3e19-6039-445b-a645-addc3de1ed25.PNG">
</p>











